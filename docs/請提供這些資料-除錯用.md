# 請你提供這些資料（除錯用）

照下面步驟做一次，把結果貼給我，我就能判斷問題出在哪一段。

---

## 一、關於「按 Widget 關閉，陪伴沒有消失」

### 步驟 1：確認有陪伴的那一頁

- 讓右下角出現小黑炭（陪伴模式打開）。
- 記住**是哪一個分頁**（例如：google.com 的那一頁）。

### 步驟 2：在「有陪伴的那一頁」開 DevTools

- 切到**有陪伴的那一個分頁**（不是 popup，也不是主站分頁）。
- 按 **F12**（或右鍵 → 檢查）打開 DevTools。
- 切到 **Console** 分頁。

### 步驟 3：按關閉陪伴

- 到擴充功能的 **popup**（點擴充圖示出現的小視窗）。
- 按一次「**陪伴模式**」按鈕，把陪伴關掉。

（若想確認 popup 有沒有收到關閉指令：在按鈕之前，先在 **popup 視窗空白處右鍵 → 檢查**，會開一個 DevTools；在 Console 裡應會看到 `[Sooty] popup 收到 CLOSE_COMPANION`。可選做。）

### 步驟 4：看 Console 並回報

請告訴我：

1. **關閉的瞬間，Console 有沒有出現這幾行？**
   - `[Sooty] content script 收到: hideCompanion`
   - `[Sooty] hideCompanion 被呼叫，container 存在: true/false, handle 存在: true/false`

2. **若完全沒有 [Sooty] 的訊息**  
   → 代表這個分頁沒有跑我們的 content script，或沒收到訊息。

3. **若有「content script 收到」但沒有「hideCompanion 被呼叫」**  
   → 代表訊息有到，但處理時出錯（較少見）。

4. **若有「hideCompanion 被呼叫，container 存在: false」**  
   → 代表陪伴的 DOM 不在這一頁（或已被清掉）。

請直接複製 Console 裡和 `[Sooty]` 有關的整段內容貼給我；若完全沒有，也寫「沒有出現任何 [Sooty]」。

---

## 二、關於「表情不同步」（主視窗傷心、陪伴普通）

### 步驟 A：比對 sootyId 是否一致

1. **主視窗的 sootyId**
   - 打開擴充 popup（主視窗）。
   - 在 popup 的**空白處**右鍵 → **檢查**（Inspect），會開一個「開發人員工具」視窗。
   - 在該視窗的 **Elements** 裡找到 `<iframe id="sooty-frame">`，看它的 **src** 網址。
   - 從網址裡抄下 `sootyId=???` 的內容（例如 `sooty-abc123-xyz`）。

2. **陪伴的 sootyId**
   - 切到**有陪伴的那一個分頁**（右下角有小黑炭）。
   - F12 → **Elements**，在畫面上對「右下角小黑炭」右鍵 → **檢查**。
   - 在 DOM 裡找到包住小黑炭的 **iframe**（src 會是 sooty-game 的 /embed 網址）。
   - 看該 iframe 的 **src**，抄下 `sootyId=???` 的內容。

3. **回報**
   - 主視窗的 sootyId：`???`
   - 陪伴的 sootyId：`???`
   - 兩個是否**完全一樣**？（是 / 否）

### 步驟 B：陪伴的 Console 是否有收到同步訊息（可選）

- **餵食／改狀態的 log 不會出現在「擴充的 Console」**，只會出現在**有陪伴的那一頁**的 **embed iframe** 的 Console。
- 做法：切到**有陪伴的那一個分頁**（右下角有小黑炭）→ F12 → **Console** → 左上角有一個下拉選單（預設是「top」或該頁網址），改成選 **embed** 或 **sooty-game.vercel.app/embed** 的那一個 frame。
- 再在**主視窗**做會改狀態的動作（例如餵食、或改測試數值），然後看 **embed 那個 Console** 有沒有出現：
  - `[Sooty 陪伴] embed 載入` …
  - `[Sooty 陪伴] BroadcastChannel 收到` …
  - `[Sooty 陪伴] storage 事件 → 已重讀 state` …

若有出現，請貼一兩行給我看；若沒有 embed 可選或完全沒這些訊息，也跟我說「沒有」。

---

## 三、總結：你只要回傳這些就好

1. **關閉陪伴時**（步驟 1～4）：  
   Console 有沒有 `[Sooty] content script 收到: hideCompanion` 和 `hideCompanion 被呼叫…`？有的話請複製貼上；沒有就寫「沒有 [Sooty] 訊息」。

2. **sootyId 比對**（步驟 A）：  
   主視窗的 sootyId、陪伴的 sootyId、是否一樣。

3. **（可選）陪伴同步 log**（步驟 B）：  
   選 embed 後，主視窗改狀態時有沒有出現 `[Sooty 陪伴]` 的 log？有或沒有、有就貼一兩行。

有這三塊資訊，就可以判斷要改哪一段程式、下一步怎麼調整。
