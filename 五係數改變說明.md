# 五係數改變說明（飢餓、口渴、幸福、精力、等級／年齡）

本文件說明小黑炭五個數值（飢餓、口渴、幸福、精力，以及年齡）在何處被加減、如何觸發。

---

## 一、係數定義與儲存

- **定義**：`components/pet-window.tsx` 的 `PetState`（約第 24–29 行）
- **上限**：`MAX_STAT = 100`（飢餓、口渴、幸福、精力皆 0–100）
- **年齡**：`age` 為 1 起算的整數，每 2 分鐘 +1（見下方「年齡」）

---

## 二、自然衰減（每 30 秒檢查一次）

**位置**：`components/pet-window.tsx`，約第 287–299 行，`useEffect` 內 `setInterval(DECAY_INTERVAL)`。

| 係數   | 常數名            | 每 30 秒減少 | 換算         |
|--------|-------------------|--------------|--------------|
| 飢餓   | `HUNGER_DECAY`    | 8/120        | 每小時 -8    |
| 口渴   | `THIRST_DECAY`    | 10/120       | 每小時 -10   |
| 幸福   | `HAPPINESS_DECAY` | 30/2880      | 每天 -30     |
| 精力   | `ENERGY_DECAY`    | 30/2880      | 每天 -30     |

計算方式：`prev.值 - DECAY` 再 `Math.max(0, ...)`，不會低於 0。

---

## 三、按鈕動作造成的加減

**定義位置**：`components/action-panel.tsx`，約第 25–109 行，`actions` 陣列。  
**套用位置**：`components/pet-window.tsx`，約第 437–441 行，`handleAction` 內 `setPetState`。

| 動作 | 飢餓 | 口渴 | 幸福 | 精力（消耗/獲得） |
|------|------|------|------|-------------------|
| 餵食 (feed)  | +25 | 0   | +10 | 0 / 0  |
| 喝水 (drink) | 0   | +30 | +5  | 0 / 0  |
| 睡覺 (sleep)| 0   | 0   | +5  | 0 / +40 |
| 玩耍 (play) | 0   | 0   | +25 | 15 消耗 / 0 |
| 散步 (walk) | 0   | 0   | 0   | 0 / 0（散步結束才結算，見下） |
| 抱抱 (love) | 0   | 0   | +30 | 10 消耗 / 0 |

精力不足時，需消耗精力的動作（玩耍、抱抱）不會執行（約第 371、424 行）。

---

## 四、其他觸發的加減

### 1. 點擊小黑炭（未在動作中、未過度點擊）

**位置**：`pet-window.tsx`，約第 473–476 行，`handleSpriteClick`。

- **幸福**：+3（`Math.min(MAX_STAT, prev.happiness + 3)`）

### 2. 深呼吸完成

**位置**：`pet-window.tsx`，約第 485–491 行，`handleBreathingComplete`。

- **幸福**：+20  
- **精力**：+15  

### 3. 番茄鐘工作完成

**位置**：`pet-window.tsx`，約第 507–513 行，`handleWorkComplete`。

- **幸福**：+15  

### 4. 番茄鐘休息結束

**位置**：`pet-window.tsx`，約第 515–521 行，`handleBreakComplete`。

- **精力**：+10  

### 5. 散步結束

**位置**：`pet-window.tsx`，約第 564–575 行，`useEffect`（`walkSecondsLeft <= 0` 時）。

- **幸福**：+12  
- **精力**：-6  

### 6. 更換小精靈（自訂造型確認）

**位置**：`pet-window.tsx`，約第 945 行，`onConfirm` 內。

- 四係數重置為：飢餓 80、口渴 85、幸福 90、精力 95。

---

## 五、年齡（等級）

- **增加方式**：每 3 小時（`AGE_INTERVAL = 3 * 60 * 60 * 1000`）`age` +1。  
  **位置**：`pet-window.tsx`，約第 302–308 行，`useEffect` 內 `setInterval(AGE_INTERVAL)`。
- **顯示**：主站顯示為「年齡」；embed 模式時強制顯示為 1（約第 841 行，`age={embedMode ? 1 : age}`）。
- **與體型關係**：`components/soot-sprite.tsx` 的 `getSizeMultiplier(age)` 依年齡計算倍率，年齡愈大小黑炭視覺上愈大（線性成長，約第 75–85 行）。

---

## 六、心情與係數的關係

- **生氣 (anger)**：飢餓或口渴 < 20、或被過度點擊、或睡覺中被叫醒（約第 261–264、276 行）。
- **難過 (sorrow)**：超過 3 分鐘沒有互動（約第 271 行，`SORROW_THRESHOLD`）。
- **嘴巴下垂**：飢餓、口渴或精力 < 30，或心情為生氣／難過時（約第 844 行，`mouthDown`）。

---

## 七、檔案對照

| 內容             | 檔案 |
|------------------|------|
| 衰減常數、定時衰減、年齡增加、動作後加減、點擊/深呼吸/番茄鐘/散步/更換 | `components/pet-window.tsx` |
| 各動作的 hungerGain / thirstGain / happinessGain / energyCost / energyGain | `components/action-panel.tsx` |
| 體型與年齡的計算 | `components/soot-sprite.tsx` |
